---
title: "3. Data Transformation with dplyr"
author: "Russ Conte"
date: "8/5/2018"
output: html_document
---

##5.1.1 Prerequisites

These lines of code will setup our dataset, nycflights13, and tidyverse which will include dplyr.
```{r, echo=TRUE}
library(nycflights13)
library(tidyverse)
```

Let's have a look at the flights data set:

```{r}
flights
```

If you want to see the entire data set, use View(dataset), for example:

```{r}
View(flights)
```

## 5.1.3 dplyr basics: Select, Filter, Mutate, Arrange, Summarize (memorize these five terms!)


Pick observations by their values (filter()).
Reorder the rows (arrange()).
Pick variables by their names (select()).
Create new variables with functions of existing variables (mutate()).
Collapse many values down to a single summary (summarise()).
Note - these can <i>all</i> be used in conjunction with group_by()

How this works:

1. The first argument is the data frame
2. The second argument is the action (filter, arrange, etc)
3. The result is a new (not saved) data frame

Let's filter the flights to show flights on January 1, for all years:

```{r}
filter(flights, month==1, day==1)
```

Note that dplyr <i><b>never</i></b> saves the output, so you'll have to save it specifically if you want it later:

```{r}
jan1 <- filter(flights, day==1, day==1)
jan1
```

To both print out the results AND save them to a variable, wrap them in parentheses:

```{r}
jan10 <- filter(flights, day==10, month==1)
```

## 5.2.4 Exercises

1. Find all flights that had:

A. Had an arrival delay of two or more hours

```{r}
filter(flights, arr_delay>120, dep_delay>120)
```

B. Flew to Houston (IAH or HOU)

```{r}
library(tidyverse)
library(nycflights13)
flights
filter(flights, dest==c("HOU", "IAH"))
```

3. Were operated by United, American, or Delta

```{r}
library(tidyverse)
library(nycflights13)
filter(flights, carrier==c("UA", "AA", "DL"))

```

4. Departed in summer (July, August, and September)

```{r}
library(tidyverse)
library(nycflights13)
filter(flights, month==c(7,8,9))

```

Arrived more than two hours late, but didnâ€™t leave late

```{r}
library(tidyverse)
library(nycflights13)
filter(flights, arr_delay>120, dep_delay<=0)
```

Were delayed by at least an hour, but made up over 30 minutes in flight

```{r}
filter(flights, arr_delay<=30, dep_delay>=60)
```

Departed between midnight and 6am (inclusive)

```{r}
filter(flights, dep_time<0600)
```

2. Another useful dplyr filtering helper is between(). What does it do? Can you use it to simplify the code needed to answer the previous challenges?

Between is useful for finding values between to given values, such as x is between 2 and 5

```{r}
filter(flights, between(dep_time, 0000,0600))
```

3. How many flights have a missing dep_time?

```{r}
sum(is.na(flights$dep_time))
```

What other variables are missing? What might these rows represent?

```{r}
colnames(flights)[colSums(is.na(flights)) > 0]
sum(is.na(flights$dep_time))
sum(is.na(flights$dep_delay))
sum(is.na(flights$arr_time))
sum(is.na(flights$arr_delay))
sum(is.na(flights$air_time))
```

These might show any number of issues, such as staff shortages, data entry problems, etc.

## 5.3 Arrange rows with Arrange

```{r}
arrange(flights, year, month, day)
```

use desc() to list in descending order:

```{r}
arrange(flights, desc(dep_delay))
```

## 5.3.1 Exercises

How could you use arrange() to sort all missing values to the start? (Hint: use is.na()).

```{r}
arrange(flights,desc(is.na(dep_delay)),desc(is.na(dep_time)), desc(is.na(arr_time)), desc(is.na(arr_delay)),
        desc(is.na(air_time)))
```

Sort flights to find the most delayed flights. 

```{r}
arrange(flights, desc(dep_delay))
```

Find the flights that left earliest.

```{r}
arrange(flights, dep_time)
```

Sort flights to find the fastest flights.

```{r}
arrange(flights, desc(time_hour))
```

Which flights travelled the longest?

```{r}
arrange(flights, desc(air_time))
```

Which flights traveled the shortest?

```{r}
arrange(flights, air_time)
```


Which travelled the shortest?